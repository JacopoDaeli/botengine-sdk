{"version":3,"sources":["dialog/dialog-action.js"],"names":[],"mappings":"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","file":"dialog/dialog-action.js","sourcesContent":["'use strict'\n\nimport _ from 'lodash'\nimport Session from '../session'\nimport Dialog from './dialog'\nimport SimpleDialog from './simple-dialog'\nimport consts from '../constants'\nimport { extractArgs } from '../utils'\n\nconst dialogAction = {\n  send (msg) {\n    const args = extractArgs(arguments, 2)\n    args.splice(0, 0, msg)\n    return function sendAction (s) {\n      Session.prototype.send.apply(s, args)\n    }\n  },\n  beginDialog (id, args) {\n    return function beginDialogAction (s, a) {\n      if (a && a.hasOwnProperty('resumed')) {\n        let r = a\n        if (r.error) {\n          s.error(r.error)\n        } else if (!s.messageSent()) {\n          s.send()\n        }\n      } else {\n        if (args) {\n          a = a || {}\n          for (let key in args) {\n            if (args.hasOwnProperty(key)) {\n              a[key] = args[key]\n            }\n          }\n        }\n        s.beginDialog(id, a)\n      }\n    }\n  },\n  endDialog (result) {\n    return function endDialogAction (s) {\n      s.endDialog(result)\n    }\n  },\n  validatedPrompt (promptType, validator) {\n    return new SimpleDialog((s, _r) => {\n      let r = _r || {}\n      let valid = false\n      if (r.response) {\n        try {\n          valid = validator(r.response)\n        } catch (e) {\n          s.endDialog({\n            resumed: Dialog.resumeReason.notCompleted,\n            error: e instanceof Error ? e : new Error(e.toString())\n          })\n        }\n      }\n      let canceled = false\n      switch (r.resumed) {\n        case Dialog.resumeReason.canceled:\n        case Dialog.resumeReason.forward:\n        case Dialog.resumeReason.back:\n          canceled = true\n          break\n      }\n      if (valid || canceled) {\n        s.endDialog(r)\n      } else if (!s.dialogData.hasOwnProperty('prompt')) {\n        s.dialogData = _.clone(r)\n        s.dialogData.promptType = promptType\n        if (!s.dialogData.hasOwnProperty('maxRetries')) {\n          s.dialogData.maxRetries = 2\n        }\n        const a = _.clone(s.dialogData)\n        a.maxRetries = 0\n        s.beginDialog(consts.DialogId.Prompt, a)\n      } else if (s.dialogData.maxRetries > 0) {\n        s.dialogData.maxRetries--\n        const a = _.clone(s.dialogData)\n        a.maxRetries = 0\n        a.prompt = s.dialogData.retryPrompt || `I didn't understand. ${s.dialogData.prompt}`\n        s.beginDialog(consts.DialogId.Prompt, a)\n      } else {\n        s.endDialog({\n          resumed: Dialog.resumeReason.notCompleted\n        })\n      }\n    })\n  }\n}\n\nexport default dialogAction\n"],"sourceRoot":"/Users/jacopodaeli/Devs/wit-bot-builder/src"}