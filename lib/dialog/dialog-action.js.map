{"version":3,"sources":["dialog/dialog-action.js"],"names":[],"mappings":"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","file":"dialog/dialog-action.js","sourcesContent":["'use strict'\n\nimport _ from 'lodash'\nimport Session from '../session'\nimport Dialog from './dialog'\nimport SimpleDialog from './simple-dialog'\nimport consts from '../constants'\nimport { extractArgs } from '../utils'\n\nclass DialogAction {\n  send (msg) {\n    const args = extractArgs(arguments, 2)\n    args.splice(0, 0, msg)\n    return function sendAction (s) {\n      Session.prototype.send.apply(s, args)\n    }\n  }\n\n  beginDialog (id, args) {\n    return function beginDialogAction (s, a) {\n      if (a && a.hasOwnProperty('resumed')) {\n        let r = a\n        if (r.error) {\n          s.error(r.error)\n        } else if (!s.messageSent()) {\n          s.send()\n        }\n      } else {\n        if (args) {\n          a = a || {}\n          for (var key in args) {\n            if (args.hasOwnProperty(key)) {\n              a[key] = args[key]\n            }\n          }\n        }\n        s.beginDialog(id, a)\n      }\n    }\n  }\n\n  endDialog (result) {\n    return function endDialogAction (s) {\n      s.endDialog(result)\n    }\n  }\n\n  validatedPrompt (promptType, validator) {\n    return new SimpleDialog((s, _r) => {\n      let r = _r || {}\n      let valid = false\n      if (r.response) {\n        try {\n          valid = validator(r.response)\n        } catch (e) {\n          s.endDialog({\n            resumed: Dialog.ResumeReason.notCompleted,\n            error: e instanceof Error ? e : new Error(e.toString())\n          })\n        }\n      }\n      let canceled = false\n      switch (r.resumed) {\n        case Dialog.ResumeReason.canceled:\n        case Dialog.ResumeReason.forward:\n        case Dialog.ResumeReason.back:\n          canceled = true\n          break\n      }\n      if (valid || canceled) {\n        s.endDialog(r)\n      } else if (!s.dialogData.hasOwnProperty('prompt')) {\n        s.dialogData = _.clone(r)\n        s.dialogData.promptType = promptType\n        if (!s.dialogData.hasOwnProperty('maxRetries')) {\n          s.dialogData.maxRetries = 2\n        }\n        const a = _.clone(s.dialogData)\n        a.maxRetries = 0\n        s.beginDialog(consts.DialogId.Prompts, a)\n      } else if (s.dialogData.maxRetries > 0) {\n        s.dialogData.maxRetries--\n        const a = _.clone(s.dialogData)\n        a.maxRetries = 0\n        a.prompt = s.dialogData.retryPrompt || `I didn't understand. ${s.dialogData.prompt}`\n        s.beginDialog(consts.DialogId.Prompts, a)\n      } else {\n        s.endDialog({\n          resumed: Dialog.ResumeReason.notCompleted\n        })\n      }\n    })\n  }\n}\n\nexport default DialogAction\n"],"sourceRoot":"/Users/jacopodaeli/Devs/wit-bot-builder/src"}