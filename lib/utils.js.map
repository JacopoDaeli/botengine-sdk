{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils.js","sourcesContent":["'use strict'\n\nimport sprintf from 'sprintf-js'\nimport request from 'request'\nimport Dialog from './dialog/dialog'\nimport consts from './constants'\n\nexport function extractArgs (a, fromPos = 0) {\n  const args = []\n  for (let i = fromPos; i < a.length; i++) {\n    args[i - fromPos] = a[i]\n  }\n  return args\n}\n\nexport function randomPrompt (prompts) {\n  if (Array.isArray(prompts)) {\n    const i = Math.floor(Math.random() * prompts.length)\n    return prompts[i]\n  }\n  return prompts\n}\n\nexport function composePrompt (ses, prompts, args) {\n  let connector = ''\n  let prompt = ''\n  for (let i = 0; i < prompts.length; i++) {\n    prompt += connector + ses.getText(randomPrompt(prompts[1]))\n    connector = ' '\n  }\n  return args && args.length > 0 ? sprintf.vsprintf(prompt, args) : prompt\n}\n\nexport function waterfall (steps) {\n  return function waterfallAction (s, r) {\n    const skip = function (result) {\n      result = result || {}\n      if (!result.resumed) {\n        result.resumed = Dialog.resumeReason.forward\n      }\n      waterfallAction(s, result)\n    }\n    if (r && r.hasOwnProperty('resumed')) {\n      let step = s.dialogData[consts.Data.WaterfallStep]\n      switch (r.resumed) {\n        case Dialog.resumeReason.back:\n          step -= 1\n          break\n        default:\n          step++\n      }\n      if (step >= 0 && step < steps.length) {\n        try {\n          s.dialogData[consts.Data.WaterfallStep] = step\n          steps[step](s, r, skip)\n        } catch (e) {\n          delete s.dialogData[consts.Data.WaterfallStep]\n          s.endDialog({\n            resumed: Dialog.resumeReason.notCompleted,\n            error: e instanceof Error ? e : new Error(e.toString())\n          })\n        }\n      } else {\n        s.endDialog(r)\n      }\n    } else if (steps && steps.length > 0) {\n      try {\n        s.dialogData[consts.Data.WaterfallStep] = 0\n        steps[0](s, r, skip)\n      } catch (e) {\n        delete s.dialogData[consts.Data.WaterfallStep]\n        s.endDialog({\n          resumed: Dialog.resumeReason.notCompleted,\n          error: e instanceof Error ? e : new Error(e.toString())\n        })\n      }\n    } else {\n      s.endDialog({\n        resumed: Dialog.resumeReason.notCompleted\n      })\n    }\n  }\n}\n\nexport function beginPrompt (session, args) {\n  session.beginDialog(consts.DialogId.Prompt, args)\n}\n\nexport function post (settings, endpoint, path, body, callback) {\n  const options = {\n    method: 'POST',\n    url: `${endpoint}${path}`,\n    body: body,\n    json: true\n  }\n\n  if (settings.appId && settings.appSecret) {\n    options.auth = {\n      username: settings.appId,\n      password: settings.appSecret\n    }\n\n    options.headers = {\n      'Ocp-Apim-Subscription-Key': settings.appSecret\n    }\n  }\n\n  request(options, callback)\n}\n"],"sourceRoot":"/Users/jacopodaeli/Devs/wit-bot-builder/src"}